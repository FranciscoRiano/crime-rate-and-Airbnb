---
title: "Data Preparation NYC"
author: "Team 99"
date: "3/21/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r, include=FALSE}
# Loading packages
library(plyr)
library(dplyr)
library(tidyverse)
library(ggplot2)
library(readr)
library(data.table)
library(R.utils)
```

```{r, include=FALSE}
# Import raw data
calendar <- read.csv("calendar.csv")
listings <- read.csv("listings.csv") 
neighbourhoods <- read.csv("neighbourhoods.csv")
crime_data <- read.csv("NYPD_Complaint_Data_Historic.csv")
```


## Data exploration
#### Airbnb data
The Airbnb dataset of New York city consists 38277 rows with data from different listings.
Below an example of the data and the variables is shown:

```{r}
head(listings)
```
A lot of these variables are not needed and that is why we will use the listings-2 dataset that is provided.
This looks as follows:
```{r}
listings <- read.csv("listings-2.csv") 
head(listings)
```

```{r listings, echo=FALSE}
unique(listings$neighbourhood_group) 
neighbourhood_count <- listings %>% group_by(neighbourhood_group) %>% summarize(count=n())
percentages <- round(neighbourhood_count$count/sum(neighbourhood_count$count)*100, 2)
percentages <- paste0(percentages, "%")
neighbourhood_count$neighbourhood_group <- paste0(neighbourhood_count$neighbourhood_group, percentages )
pie(neighbourhood_count$count,neighbourhood_count$neighbourhood_group, main= "listings per neighbourhood")
```

####Crime data 
The crime data consists of 7375993 rows of crimes comitted in New York City.
```{r}
head(crime_data)
```
There are 35 different variables. The ones that are most relevant are selected

```{r}
crime_data<- crime_data[,c('CMPLNT_NUM', 'ADDR_PCT_CD', 'BORO_NM','CMPLNT_FR_DT','CMPLNT_TO_DT','CRM_ATPT_CPTD_CD','KY_CD','LAW_CAT_CD','OFNS_DESC','RPT_DT','Latitude','Longitude')]
head(crime_data)
```
####Dictionary of the variables:
Column name         | Column description
-------------       | -------------
CMPLNT_NUM          | Randomly generated persistent ID for each complaint 
ADDR_PCT_CD         | The precinct in which the incident occurred
BORO                | The name of the borough in which the incident occurred
CMPLNT_FR_DT        | Exact date of occurrence for the reported event (or starting date of occurrence, if CMPLNT_TO_DT exists)
CMPLNT_TO_DT        | Ending date of occurrence for the reported event, if exact time of occurrence is unknown
CRM_ATPT_CPTD_CD    | Indicator of whether crime was successfully completed or attempted, but failed or was interrupted prematurely
KY_CD               | Three digit offense classification code
LAW_CAT_CD          | Level of offense: felony, misdemeanor, violation 
OFNS_DESC           | Description of offense corresponding with key code
RPT_DT              | Date event was reported to police 
Latitude            | Midblock Latitude coordinate for Global Coordinate System, WGS 1984, decimal degrees (EPSG 4326) 
Longitude           | Midblock Longitude coordinate for Global Coordinate System, WGS 1984, decimal degrees (EPSG 4326)

```{r crimes, echo=FALSE}
crimes_per_neighbourhood <- crime_data %>% group_by(BORO_NM) %>% summarize(count=n())
percentages <- round(crimes_per_neighbourhood$count/sum(crimes_per_neighbourhood$count)*100, 2)
percentages <- paste0(percentages, "%")
crimes_per_neighbourhood$BORO_NM <- paste0(crimes_per_neighbourhood$BORO_NM, percentages )
pie(crimes_per_neighbourhood$count,crimes_per_neighbourhood$BORO_NM, main= "crimes per neighbourhood")
```


```{r}
crime_cat <- crime_data %>% 
  group_by(BORO_NM, LAW_CAT_CD) %>% 
  summarize(count = n())
ggplot(crime_cat,                                     
       aes(x = BORO_NM,
           y = count,
           fill = LAW_CAT_CD)) +
  geom_bar(stat = "identity",
           position = "dodge")+ ggtitle("Crime categories per neighbourhood") +
  xlab("neighbourhood") + ylab("Count") +labs(fill="Category")

#number of missing neighbourhoods
crime_cat
sum(filter(crime_cat, BORO_NM=="")[3])

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
